<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="no-referrer">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-center-atom.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Elasticsearch,ELK,搜索引擎,">





  <link rel="alternate" href="/atom.xml" title="黑白之院" type="application/atom+xml">






<meta name="description" content="引言在很多应用场景下，我们都需要搜索功能，不管是在 App 中还是网站中。搜索每时每刻都在发生，比如搜索喜欢的零食、好看的衣服、喜欢的文章、想要学习的课程等等。如今要为我们的应用添加搜索已经非常容易了，早期我们可以使用 MySQL 的 MyISAM 存储引擎来做全文本搜索支持，不过今天要说的 Elasticsearch 同样可以做到，而且更强大。简单来说，Elasticsearch 是一个分布式搜">
<meta name="keywords" content="Elasticsearch,ELK,搜索引擎">
<meta property="og:type" content="article">
<meta property="og:title" content="初识 Elasticsearch">
<meta property="og:url" content="http://ifaceless.space/2020/01/15/elasticsearch-intro/index.html">
<meta property="og:site_name" content="黑白之院">
<meta property="og:description" content="引言在很多应用场景下，我们都需要搜索功能，不管是在 App 中还是网站中。搜索每时每刻都在发生，比如搜索喜欢的零食、好看的衣服、喜欢的文章、想要学习的课程等等。如今要为我们的应用添加搜索已经非常容易了，早期我们可以使用 MySQL 的 MyISAM 存储引擎来做全文本搜索支持，不过今天要说的 Elasticsearch 同样可以做到，而且更强大。简单来说，Elasticsearch 是一个分布式搜">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://pic3.zhimg.com/v2-8ea49800d9c7e5e4f147349ca3237593.png">
<meta property="og:image" content="https://pic1.zhimg.com/v2-b165c6321a00d62c6c5ab2b2ac0994bb.png">
<meta property="og:image" content="https://pic3.zhimg.com/v2-f8f2d20ee4cd5a1cc87c4ddba58f0078.jpg">
<meta property="og:image" content="https://pic2.zhimg.com/v2-f2d85b3f20fc985bf5b47c8927c2afcf.jpg">
<meta property="og:updated_time" content="2020-01-15T06:44:16.554Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="初识 Elasticsearch">
<meta name="twitter:description" content="引言在很多应用场景下，我们都需要搜索功能，不管是在 App 中还是网站中。搜索每时每刻都在发生，比如搜索喜欢的零食、好看的衣服、喜欢的文章、想要学习的课程等等。如今要为我们的应用添加搜索已经非常容易了，早期我们可以使用 MySQL 的 MyISAM 存储引擎来做全文本搜索支持，不过今天要说的 Elasticsearch 同样可以做到，而且更强大。简单来说，Elasticsearch 是一个分布式搜">
<meta name="twitter:image" content="https://pic3.zhimg.com/v2-8ea49800d9c7e5e4f147349ca3237593.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://ifaceless.space/2020/01/15/elasticsearch-intro/">





  <title>初识 Elasticsearch | 黑白之院</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">黑白之院</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Valar Morghulis</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-收藏">
          <a href="/collection" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-star"></i> <br>
            
            收藏
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ifaceless.space/2020/01/15/elasticsearch-intro/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="iFaceless">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黑白之院">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">初识 Elasticsearch</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-15T14:06:48+08:00">
                2020-01-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">Elasticsearch</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  12
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>在很多应用场景下，我们都需要搜索功能，不管是在 App 中还是网站中。搜索每时每刻都在发生，比如搜索喜欢的零食、好看的衣服、喜欢的文章、想要学习的课程等等。如今要为我们的应用添加搜索已经非常容易了，早期我们可以使用 MySQL 的 MyISAM 存储引擎来做全文本搜索支持，不过今天要说的 Elasticsearch 同样可以做到，而且更强大。简单来说，Elasticsearch 是一个分布式搜索和分析引擎，也是众所周知的 ELK Stack 核心成员。它以 JSON 的格式存储文档到索引当中，能够高效地存储多种类型，并提供快速搜索的能力。此外，整个 ELK Stack 生态非常完善。</p>
<a id="more"></a>
<p>那么接下来，我们将跟着官方文档学习下 Elasticsearch 具体是什么？适用的场景有哪些？支持什么数据类型存储和检索？</p>
<p><em>PS: 我们在生产环境中，使用 ES 构建了课程商品（SKU）索引，方便对用户、管理后台提供课程搜索能力。</em></p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p><a href="https://github.com/deviantony/docker-elk" target="_blank" rel="noopener">docker-elk</a> 仓库提供了在 Docker 环境下搭建 ELK Stack 服务的配置，我们可以参考其说明文档进行安装（在 macOS Catalina 环境下操作）。</p>
<ol>
<li>克隆仓库：<code>git clone git@github.com:deviantony/docker-elk.git</code></li>
<li>第一次需要运行 <code>docker-compose build</code>，等待构建完成</li>
<li>需要在 <code>docker-compose.yml</code> 中修改下 ES 的密码，当然还有 <code>elasticsearch/config</code>，<code>kibana/config</code>, <code>logstash/config</code> 中都有密码需要修改。由于是在本地学习，所以只是简单设置了下密码。生产环境建议参考文档，生成复杂的密码</li>
<li>运行 <code>docker-compose up [-d]</code> 即可启动</li>
<li>关闭 <code>docker-compose down -v</code></li>
</ol>
<p>注意事项：</p>
<ol>
<li>配置文件并非动态加载，每次变更后需要重启对应的组件</li>
<li>端口映射说明：<ol>
<li>9200: ES HTTP</li>
<li>9300: ES TCP</li>
<li>5000: Logstash TCP input</li>
<li>5601: Kibana</li>
</ol>
</li>
</ol>
<p>启动成功后，可以打开 Kibana 开始探索啦~<br><img src="https://pic3.zhimg.com/v2-8ea49800d9c7e5e4f147349ca3237593.png" alt=""></p>
<h1 id="Elasticsearch-简介"><a href="#Elasticsearch-简介" class="headerlink" title="Elasticsearch 简介"></a>Elasticsearch 简介</h1><p>Elasticsearch 是一个<strong>分布式搜索和分析引擎</strong>，ELK 栈的核心组成部分。而 Logstash 和 Beats 用于<strong>收集</strong>、<strong>聚合</strong>、<strong>转换</strong>数据，并将其存储在 Elasticsearch 当中。而 Kibana 则让我们能够便捷探索、查看并分享数据，同时也用来管理 ELK 栈。</p>
<p>ES 提供了实时的搜索和分析能力，支持多种数据类型（结构化、非结构化、数字、地理位置等），ES 会高效地存储并索引这些数据，从而支持快速搜索。由于分布式的特点，随着数据集的增加，可以轻松地进行水平扩展来提高服务可靠性和性能。</p>
<p>ES 支持的使用场景包括：</p>
<ol>
<li><strong>为我们的 App 或网站提供搜索支持</strong></li>
<li><strong>可以存储分析日志（analyze logs）、指标数据（metrics）、安全事件数据（security event data）</strong></li>
<li>基于机器学习根据数据实时建模</li>
<li>可以用作 GIS 系统（地理信息系统），用于管理、集成并分析空间信息</li>
<li>可以用于生物学研究工具，存储并处理基因数据</li>
</ol>
<h1 id="文档和索引"><a href="#文档和索引" class="headerlink" title="文档和索引"></a>文档和索引</h1><p>ES 本质上还是一个分布式文档存储服务（类比 Mongo？），实际在索引中存储的是 JSON 格式的文档。在 ES 集群中，文档会被分布到整个集群存储的，并且能够从任意一个节点立刻访问到。</p>
<p>一旦新的文档存储到索引后，几乎可以立刻被搜索到（1s 以内），因此可以构建近乎实时的搜索引擎。那么 ES 究竟是如何做到的呢？简单来说，它使用了<strong>倒排索引（inverted index）</strong>这种数据结构来支持全文本搜索。所谓的<strong>倒排索引</strong>就是对文本进行分词，然后记录每个分词所在的文档 id（当然还有词频等信息），这样在查询时可以基于分词快速定位所在的文档。</p>
<p>在 ES 中，<strong>索引</strong>是一个很重要的概念（回顾下 MySQL InnoDB 的聚簇索引，表中的记录存储在 B-Tree Node 上，基于 B+ Tree 这种数据结构快速定位记录所在的页），但是这里的索引和在关系数据库中提到的索引有所差别。总结下特点：</p>
<ol>
<li>ES 的<strong>索引（index）</strong>可以看成<strong>文档（document）</strong>的集合；</li>
<li>每个<strong>文档（document）</strong>可以看成<strong>字段（field）</strong>（类比下字典中的 key-value）的集合；<br><img src="https://pic1.zhimg.com/v2-b165c6321a00d62c6c5ab2b2ac0994bb.png" alt=""></li>
</ol>
<p>默认设置下，ES 会为文档中的每个字段建立索引，并且每个字段都会匹配专门优化的数据结构以达到高效存储和快速搜索的目的。比如：文本使用<strong>倒排索引</strong>，数字和地理位置使用 <a href="https://www.shenyanchao.cn/blog/2018/12/04/lucene-bkd/" target="_blank" rel="noopener">BKD 树</a>。</p>
<p>ES 支持 schema-less，这样我们就不用为每个字段显式指定索引方式。当我们启用动态映射（dynamic mapping）时（这个是默认设置），ES 会自动检测到新增字段，自动将文档中的 bool 值、浮点数、整数、日期、字符串等映射成合适的 ES 数据类型。</p>
<p>当然，某些情况下，我们可能想要关闭动态映射的功能，这时可以自定义映射规则，从而控制每个字段存储和索引的方式。自定义映射带可以：</p>
<ol>
<li>区分全文本字符串字段和精确匹配的字符串字段；</li>
<li>执行特定语言的文本分析；</li>
<li>优化部分匹配；</li>
<li>使用自定义日期格式；</li>
<li>使用一些无法自动检测到的数据类型（如 <code>geo_point</code>, <code>geo_shape</code>）。</li>
</ol>
<p>此外，ES 可以为相同的字段建立不同的索引，以满足不同的需求场景。</p>
<h1 id="搜索与分析"><a href="#搜索与分析" class="headerlink" title="搜索与分析"></a>搜索与分析</h1><p>ES 提供了非常简单易于使用的 REST API，可以利用它们管理集群、索引和搜索数据。我们既可以在 Kibana 控制台中和 ES 交互，也可以使用各个语言（支持 Java, JavaScript, Go, .Net, PHP, Perl, Python, Ruby 等）的客户端进行交互。</p>
<h2 id="搜索数据"><a href="#搜索数据" class="headerlink" title="搜索数据"></a>搜索数据</h2><p><em>目前支持两种查询方式：JSON Query DSL 和 SQL。</em></p>
<p>ES API 允许我们使用结构化查询、全文本查询或者二者组合：</p>
<ol>
<li><strong>结构化查询</strong>：类似 SQL 那样，我们可以搜索某几个字段，基于某字段排序等；</li>
<li><strong>全文本查询</strong>：返回匹配关键词的文档，返回的结果基于相关性排序。</li>
</ol>
<p>此外，还支持单独分词（individual terms）查询，我们可以执行短语搜索（phrase searches）、相似度搜索（similarity searches）和前缀搜索（prefix searches），甚至可以得到自动补全的建议。当然，对于地理位置或者数字类型的数据，ES 也可以提供高效的查询功能。</p>
<h2 id="分析数据"><a href="#分析数据" class="headerlink" title="分析数据"></a>分析数据</h2><p>ES 允许我们执行<strong>聚合（aggregation）</strong>操作，从而对关键的指标、 增长趋势等有更为深刻的认识。ES 高效聚合的能力，可以让我们能够实时地分析和可视化数据。我们可以把搜索和聚合联合在一起使用，这样就可以在搜索、过滤文档的同时，对相同的结果进行分析。</p>
<p>此外，ES 还提供了自动分析时序数据的功能，也就是利用机器学习来发现数据中的异常，不过这块属于高级功能了，有兴趣的话可以自行研究下~</p>
<h1 id="高可用、可伸缩与可靠性"><a href="#高可用、可伸缩与可靠性" class="headerlink" title="高可用、可伸缩与可靠性"></a>高可用、可伸缩与可靠性</h1><p><img src="https://pic3.zhimg.com/v2-f8f2d20ee4cd5a1cc87c4ddba58f0078.jpg" alt=""></p>
<p>既然是分布式搜索引擎，高可用和可伸缩的能力自然是 ES 必备技能。我们可以按需给集群增加服务器（节点）实现扩容。ES 会自动将数据和查询负载均衡到<strong>可用节点</strong>上，以实现伸缩和高可用。</p>
<p>那么，ES 是如何存储和维护索引的呢？简单来说，每个 ES <strong>索引（index）</strong>其实是一个到多个<strong>物理分片（physical shards）</strong> 所组成的<strong>逻辑分组（logical group）</strong>；每个分片实际是<strong>自包含索引（self-contained index）</strong>。通过将索引放到多个分片存储，然后将分片分布到多个节点上，ES 可以为分片提供冗余备份，从而达到水平扩展和高可用的目的。随着集群的扩容（或缩容），ES 会自动再均衡，必要时也会合并分片。</p>
<h2 id="关于分片（shards）"><a href="#关于分片（shards）" class="headerlink" title="关于分片（shards）"></a>关于分片（shards）</h2><p>分片分为两种类型：</p>
<ol>
<li><strong>主分片（primary shard）</strong>：索引中的每个文档都属于某个主分片。</li>
<li><strong>副本分片（replicas）</strong>：副本分片其实就是主分片的拷贝，一方面实现数据冗余，另一方面也对外提供读服务（搜索、获取文档等）。</li>
</ol>
<p>需要注意的是，<strong>索引的主分片数在创建后就不能修改了，只能重建靠重建索引来扩展主分片数</strong>，但是副本分片数可以随时修改，不会打断索引和查询操作。</p>
<p>那么问题来了，索引的主分片数越多越好吗？显然不是这样的。我们需要考虑索引的数据量大小，尽可能保证每个分片不要太大，分片数量不要过多。</p>
<p>我们先来看看分片数过多会导致的问题吧：</p>
<ol>
<li>每个分片其实都是一个 Lucene 索引，会占用更多的文件描述符、内存和 CPU 资源；</li>
<li>搜索会被分配到各个分片上，如果分片都位于不同节点还好，要是集中在某个节点，则会出现热点问题，资源竞争激烈，性能也会下降；</li>
<li>过多的分片也会导致过多的分片请求，会产生一定的网络开销等；</li>
<li>ES 使用词频来统计匹配的相关性，统计会被分配到各个分片上，如果大量分片上只维护了很少的数据，则会导致最终的文档的相关性较差。</li>
</ol>
<p>如果每个分片过大，则会导致集群再均衡办时，搬迁数据更耗时。总而言之，我们需要通过测试来确定最佳的配置。起初可以这样：</p>
<ol>
<li>保证每个分片的大小在 GB 到几十 GB 范围。对于常见的时序数据，分片大小在 20GB ~ 40GB 也很常见。参考文献中给出的大小限制为 30GB。</li>
<li>避免过大的分片问题。每个节点可容纳的分片数量和可用的堆空间成正比，每 GB 堆空间分片数应该小于 20。</li>
</ol>
<h2 id="灾备"><a href="#灾备" class="headerlink" title="灾备"></a>灾备</h2><p>考虑性能的因素，通常集群中的节点应该位于相同的网络环境。跨数据中心均衡分片非常耗时，可靠性也会降低。但是高可用架构设计就是要保证我们不要把鸡蛋放在一个篮子里，这样一旦某处的服务器宕机，位于其它位置的服务器可以接替继续提供服务。</p>
<p>ES 为我们提供了 CCR 功能（跨集群复制，Cross-cluster replication），这样可以将主集群的索引同步到远程的集群作为热备，同时也可以基于地理位置使用其它集群提供读请求。所有的写入操作都在主集群完成，其它的副本集群都是只读的 Followers。</p>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p><img src="https://pic2.zhimg.com/v2-f2d85b3f20fc985bf5b47c8927c2afcf.jpg" alt=""></p>
<h1 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h1><p>生产环境创建索引模板：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">PUT /_template/km_server_warehouse_template</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"order"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"index_patterns"</span>: [</span><br><span class="line">    <span class="string">"km_server_warehouse*"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"settings"</span>: &#123;</span><br><span class="line">    <span class="attr">"index"</span>: &#123;</span><br><span class="line">      <span class="attr">"analysis"</span>: &#123;</span><br><span class="line">        <span class="attr">"analyzer"</span>: &#123;</span><br><span class="line">          <span class="attr">"znlp-coarse"</span>: &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"custom"</span>,</span><br><span class="line">            <span class="attr">"tokenizer"</span>: <span class="string">"znlp-fine"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"number_of_shards"</span>: <span class="string">"1"</span>,</span><br><span class="line">      <span class="attr">"translog"</span>: &#123;</span><br><span class="line">        <span class="attr">"sync_interval"</span>: <span class="string">"5s"</span>,</span><br><span class="line">        <span class="attr">"durability"</span>: <span class="string">"async"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"number_of_replicas"</span>: <span class="string">"4"</span>,</span><br><span class="line">      <span class="attr">"similarity"</span>: &#123;</span><br><span class="line">        <span class="attr">"scripted_bm25"</span>: &#123;</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"scripted"</span>,</span><br><span class="line">          <span class="attr">"script"</span>: &#123;</span><br><span class="line">            <span class="attr">"source"</span>: <span class="string">"double k1 = 1.2; double b = 0.75; double tfNorm = doc.freq * (k1 + 1) / (doc.freq + k1 * (1 - b + b * doc.length / (1.0 * field.sumTotalTermFreq/field.docCount))); return query.boost * tfNorm;"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"mappings"</span>: &#123;</span><br><span class="line">    <span class="attr">"contents"</span>: &#123;</span><br><span class="line">      <span class="attr">"dynamic"</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">"properties"</span>: &#123;</span><br><span class="line">        <span class="attr">"content_basic"</span>: &#123;</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"nested"</span>,</span><br><span class="line">          <span class="attr">"properties"</span>: &#123;</span><br><span class="line">            <span class="attr">"sku_id"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"business_id"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"business_type"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"producer"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"svip_right"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"nested"</span>,</span><br><span class="line">              <span class="attr">"properties"</span>: &#123;</span><br><span class="line">                <span class="attr">"free"</span>: &#123;</span><br><span class="line">                  <span class="attr">"type"</span>: <span class="string">"boolean"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"discount"</span>: &#123;</span><br><span class="line">                  <span class="attr">"type"</span>: <span class="string">"short"</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"instabook_right"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"nested"</span>,</span><br><span class="line">              <span class="attr">"properties"</span>: &#123;</span><br><span class="line">                <span class="attr">"free"</span>: &#123;</span><br><span class="line">                  <span class="attr">"type"</span>: <span class="string">"boolean"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"discount"</span>: &#123;</span><br><span class="line">                  <span class="attr">"type"</span>: <span class="string">"short"</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"svip_privileges"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"boolean"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"title"</span>: &#123;</span><br><span class="line">              <span class="attr">"similarity"</span>: <span class="string">"scripted_bm25"</span>,</span><br><span class="line">              <span class="attr">"analyzer"</span>: <span class="string">"znlp-fine"</span>,</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"text"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"authors"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"right_list"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"serial_status"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"short"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"public_status"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"short"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"online_time"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"categories"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"nested"</span>,</span><br><span class="line">              <span class="attr">"properties"</span>: &#123;</span><br><span class="line">                <span class="attr">"id"</span>: &#123;</span><br><span class="line">                  <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"level"</span>: &#123;</span><br><span class="line">                  <span class="attr">"type"</span>: <span class="string">"short"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"weight"</span>: &#123;</span><br><span class="line">                  <span class="attr">"type"</span>: <span class="string">"short"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"name"</span>: &#123;</span><br><span class="line">                  <span class="attr">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">                  <span class="attr">"fields"</span>: &#123;</span><br><span class="line">                    <span class="attr">"keyword"</span>: &#123;</span><br><span class="line">                      <span class="attr">"ignore_above"</span>: <span class="number">256</span>,</span><br><span class="line">                      <span class="attr">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"name_en"</span>: &#123;</span><br><span class="line">                  <span class="attr">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">                  <span class="attr">"fields"</span>: &#123;</span><br><span class="line">                    <span class="attr">"keyword"</span>: &#123;</span><br><span class="line">                      <span class="attr">"ignore_above"</span>: <span class="number">256</span>,</span><br><span class="line">                      <span class="attr">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"is_test"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"boolean"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"content_aggregation"</span>: &#123;</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"nested"</span>,</span><br><span class="line">          <span class="attr">"properties"</span>: &#123;</span><br><span class="line">            <span class="attr">"interest_count"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"created_at"</span>: &#123;</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"updated_at"</span>: &#123;</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"aliases"</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-intro.html" target="_blank" rel="noopener">ES 介绍</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html" target="_blank" rel="noopener">Query DSL</a></li>
<li><a href="https://www.cnblogs.com/ningskyer/articles/5789010.html" target="_blank" rel="noopener">Elasticsearch系统概念及架构图</a></li>
<li><a href="https://blog.csdn.net/zx711166/article/details/81517178" target="_blank" rel="noopener">倒排索引</a></li>
<li><a href="https://elasticsearch.cn/article/711" target="_blank" rel="noopener">聊聊 ELASTICSEARCH 的集群状态的管理和维护</a></li>
<li><a href="https://logz.io/learn/complete-guide-elk-stack/#intro" target="_blank" rel="noopener">THE COMPLETE GUIDE TO THE ELK STACK</a></li>
<li><a href="https://www.edureka.co/blog/elk-stack-tutorial/" target="_blank" rel="noopener">ELK Stack Tutorial – Discover, Analyze And Visualize Your Data Efficiently</a></li>
<li><a href="https://www.shenyanchao.cn/blog/2018/12/04/lucene-bkd/" target="_blank" rel="noopener">Lucene BKD树-动态磁盘优化BSP树</a></li>
<li><a href="https://www.cnblogs.com/bigben0123/p/11274296.html" target="_blank" rel="noopener">聊聊 ES 分片优化</a></li>
</ul>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    iFaceless
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://ifaceless.space/2020/01/15/elasticsearch-intro/" title="初识 Elasticsearch">http://ifaceless.space/2020/01/15/elasticsearch-intro/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Elasticsearch/" rel="tag"><i class="fa fa-tag"></i> Elasticsearch</a>
          
            <a href="/tags/ELK/" rel="tag"><i class="fa fa-tag"></i> ELK</a>
          
            <a href="/tags/搜索引擎/" rel="tag"><i class="fa fa-tag"></i> 搜索引擎</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/12/29/craw-dilivery-network-distribution/" rel="next" title="快递网点抓取杂记">
                <i class="fa fa-chevron-left"></i> 快递网点抓取杂记
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/01/20/rust-async-std-intro/" rel="prev" title="Rust async-std 入门">
                Rust async-std 入门 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="iFaceless">
            
              <p class="site-author-name" itemprop="name">iFaceless</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">41</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">71</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/ifaceless" target="_blank" title="GitHub">
                      GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:me#ifaceless.space" target="_blank" title="邮箱">
                      邮箱</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://zhuanlan.zhihu.com/0xe8551ccb" target="_blank" title="专栏">
                      专栏</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                常用链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://xieyuanpeng.com" title="Lingering Fragments" target="_blank">Lingering Fragments</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.acolyer.org/" title="The Morning Paper" target="_blank">The Morning Paper</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.freecodecamp.org" title="freeCodeCamp" target="_blank">freeCodeCamp</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://draveness.me/" title="Draveness's Blog" target="_blank">Draveness's Blog</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#引言"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装"><span class="nav-number">2.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Elasticsearch-简介"><span class="nav-number">3.</span> <span class="nav-text">Elasticsearch 简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#文档和索引"><span class="nav-number">4.</span> <span class="nav-text">文档和索引</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#搜索与分析"><span class="nav-number">5.</span> <span class="nav-text">搜索与分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#搜索数据"><span class="nav-number">5.1.</span> <span class="nav-text">搜索数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分析数据"><span class="nav-number">5.2.</span> <span class="nav-text">分析数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#高可用、可伸缩与可靠性"><span class="nav-number">6.</span> <span class="nav-text">高可用、可伸缩与可靠性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#关于分片（shards）"><span class="nav-number">6.1.</span> <span class="nav-text">关于分片（shards）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#灾备"><span class="nav-number">6.2.</span> <span class="nav-text">灾备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#架构"><span class="nav-number">6.3.</span> <span class="nav-text">架构</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#实践"><span class="nav-number">7.</span> <span class="nav-text">实践</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考"><span class="nav-number">8.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">黑白之院（iFaceless）</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

</body>
</html>
